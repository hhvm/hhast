<?hh // strict

/**
 * Copyright (c) 2016, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional
 * grant of patent rights can be found in the PATENTS file in the same
 * directory.
 *
 */

namespace MyNamespace {

use function preg_match as analbumcover;
use function \preg_match_all as catchthesemen;

function foo(): void {
  $matches = null;

  \preg_match('/foo/', 'bar');
  \preg_match_all('/foo/', 'bar');

  \preg_match('/foo/', 'bar', &$matches);
  \preg_match_all('/foo/', 'bar', &$matches);

  \preg_match('/foo/', 'bar', inout $matches);
  \preg_match_all('/foo/', 'bar', inout $matches);

  \preg_match('/foo/', 'bar', inout $matches, \PREG_UNMATCHED_AS_NULL, 42);
  \preg_match_all(
    '/foo/',
    'bar',
    &$matches,
    \PREG_SET_ORDER | \PREG_OFFSET_CAPTURE,
  );

  if (\preg_match('/foo/', 'bar', &$matches)) {
    return;
  }

  \ // Trivia in the middle of the function name is lost...
  preg_match /* ...but trivia at the end is preserved. */ (
    '/foo/',
    'bar',
    &/* no space here */$matches,
  );

  // Aliased.
  analbumcover('/foo/', 'bar', &$matches);
  catchthesemen('/foo/', 'bar', inout $matches);

  // Not in the root namespace.
  preg_match('/foo/', 'bar', &$matches);
  MyNamespace\preg_match_all('/foo/', 'bar', &$matches);

  // Some other functions.
  \current(&$arr);
  \key(inout $arr);

  // By-ref to inout without renaming.
  \reset(&$arr);
}

} // end of MyNamespace


function bar(): void {
  $matches = null;
  preg_match('/foo/', 'bar', &$matches);
}